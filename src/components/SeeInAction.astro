---
import seeInAction from "../data/seeInAction.json";
const { galleryImages, content } = seeInAction;

// Styles yang digunakan berulang
const styles = {
  galleryItem:
    "group flex flex-col p-3 rounded-xl bg-white/60 dark:bg-white/5 backdrop-blur-sm border border-gray-200 dark:border-white/10 hover:border-primary-500/30 dark:hover:border-primary-500/30 transition-all duration-300",
  galleryImage:
    "w-full h-48 md:h-56 object-cover rounded-lg mb-4 transition-transform duration-500 group-hover:scale-[1.02]",
  carouselButton:
    "absolute top-1/2 -translate-y-1/2 bg-white/80 dark:bg-white/5 hover:bg-white dark:hover:bg-white/10 text-gray-800 dark:text-white rounded-lg p-3 focus:outline-none transition-all duration-200 border border-gray-200 dark:border-white/20 hover:border-primary-500/30 backdrop-blur-sm",
};
---

<section
  id="see-in-actions"
  class="py-16 md:py-24 px-6 relative overflow-hidden bg-gradient-to-br from-indigo-50/50 via-white to-purple-50/50 dark:from-gray-900 dark:via-black dark:to-gray-900"
>
  <!-- Background Decorations -->
  <div
    class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full -z-10 pointer-events-none"
  >
    <div
      class="absolute top-1/4 left-1/4 w-96 h-96 bg-primary-600/10 rounded-full blur-[120px]"
    >
    </div>
    <div
      class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-accent-600/10 rounded-full blur-[120px]"
    >
    </div>
  </div>

  <div class="max-w-6xl mx-auto">
    <div class="text-center mb-16">
      <h2
        class="text-4xl md:text-5xl font-extrabold mb-6 tracking-tight text-gray-900 dark:text-white"
      >
        {content.title}
        <span
          class="bg-gradient-to-r from-primary-400 to-primary-600 bg-clip-text text-transparent"
        >
          {content.brandName}
        </span>
      </h2>
      <p
        class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto leading-relaxed"
      >
        {content.subtitle}
      </p>
    </div>

    <!-- Image Gallery Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        galleryImages.map((image, index) => (
          <div class={styles.galleryItem} data-index={index}>
            <div class="relative overflow-hidden rounded-lg mb-4">
              <img
                src={image.src}
                alt={image.alt}
                class={styles.galleryImage}
                loading="lazy"
              />
            </div>

            <div class="flex items-center gap-2 mb-2">
              <span
                class="w-2 h-2 rounded-full"
                style={`background-color: ${image.color}`}
              />
              <span class="text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">
                {image.capability}
              </span>
            </div>
            <h3 class="text-gray-900 dark:text-white text-lg font-bold leading-tight group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
              {image.role}
            </h3>
          </div>
        ))
      }
    </div>

    <!-- Lightbox Modal -->
    <div
      id="lightbox-modal"
      class="fixed inset-0 z-[100] hidden bg-black/95 flex items-center justify-center backdrop-blur-sm p-4 md:p-10"
    >
      <div
        class="relative w-full max-w-5xl flex flex-col md:flex-row bg-white dark:bg-white/5 backdrop-blur-xl rounded-2xl overflow-hidden border border-gray-200 dark:border-white/10 shadow-2xl"
      >
        <!-- Close Button -->
        <button
          id="close-lightbox"
          class="absolute top-5 right-5 text-gray-800 dark:text-white z-[110] bg-white/80 dark:bg-white/5 hover:bg-white dark:hover:bg-white/10 backdrop-blur-md rounded-full w-10 h-10 flex items-center justify-center transition-all duration-300 border border-gray-200 dark:border-white/20"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>

        <!-- Image side -->
        <div
          class="w-full md:w-3/4 bg-gray-100 dark:bg-black/20 flex items-center justify-center p-2 min-h-[50vh] md:min-h-0"
        >
          <div
            id="lightbox-carousel"
            class="relative w-full h-full flex items-center justify-center"
          >
            <div
              id="carousel-items"
              class="relative w-full flex items-center justify-center animate-fade-in"
            >
              <!-- Image added via JS -->
            </div>

            <!-- Controls -->
            <button id="prev-slide" class={`${styles.carouselButton} left-4`}>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button id="next-slide" class={`${styles.carouselButton} right-4`}>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Info side -->
        <div
          id="lightbox-info"
          class="w-full md:w-1/4 p-8 flex flex-col justify-center border-t md:border-t-0 md:border-l border-gray-200 dark:border-white/10 bg-white dark:bg-white/5"
        >
          <div
            id="info-badge"
            class="inline-block px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-widest mb-4 border border-gray-200 dark:border-white/10"
          >
          </div>
          <h3
            id="info-title"
            class="text-2xl font-bold text-gray-900 dark:text-white mb-4 leading-tight"
          >
          </h3>
          <p
            id="info-desc"
            class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed mb-8"
          >
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: scale(0.98);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  .animate-fade-in {
    animation: fade-in 0.4s ease-out forwards;
  }
</style>

<script is:inline define:vars={{ galleryImages }}>
  document.addEventListener("DOMContentLoaded", () => {
    const galleryItems = document.querySelectorAll("[data-index]");
    const lightboxModal = document.getElementById("lightbox-modal");
    const carouselItems = document.getElementById("carousel-items");
    const closeButton = document.getElementById("close-lightbox");
    const prevButton = document.getElementById("prev-slide");
    const nextButton = document.getElementById("next-slide");

    // Info elements
    const infoBadge = document.getElementById("info-badge");
    const infoTitle = document.getElementById("info-title");
    const infoDesc = document.getElementById("info-desc");

    let currentIndex = 0;

    // Add click event to open lightbox
    galleryItems.forEach((item) => {
      item.addEventListener("click", () => {
        const index = parseInt(item.getAttribute("data-index"));
        openLightbox(index);
      });
    });

    function openLightbox(index) {
      currentIndex = index;
      updateCarousel();
      lightboxModal.classList.remove("hidden");
      document.body.classList.add("overflow-hidden");
    }

    function closeLightbox() {
      lightboxModal.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }

    function updateCarousel() {
      const data = galleryImages[currentIndex];

      // Update Image
      carouselItems.innerHTML = "";
      const imgElement = document.createElement("img");
      imgElement.src = data.src;
      imgElement.alt = data.alt;
      imgElement.className =
        "max-w-full max-h-[70vh] md:max-h-[85vh] object-contain rounded-lg shadow-2xl transition-all duration-500";
      carouselItems.appendChild(imgElement);

      // Update Info
      infoBadge.textContent = data.capability;
      infoBadge.style.backgroundColor = data.color + "22";
      infoBadge.style.color = data.color;
      infoTitle.textContent = data.role;
      infoDesc.textContent = `Asisten AIPEDIA membantu Anda menyelesaikan ${data.role.toLowerCase()} secara cepat dan profesional. Tingkatkan produktivitas bisnis Anda hari ini.`;

      // Trigger animation
      carouselItems.classList.remove("animate-fade-in");
      void carouselItems.offsetWidth; // trigger reflow
      carouselItems.classList.add("animate-fade-in");
    }

    closeButton.addEventListener("click", closeLightbox);

    lightboxModal.addEventListener("click", (e) => {
      if (e.target === lightboxModal) closeLightbox();
    });

    prevButton.addEventListener("click", (e) => {
      e.stopPropagation();
      currentIndex =
        (currentIndex - 1 + galleryImages.length) % galleryImages.length;
      updateCarousel();
    });

    nextButton.addEventListener("click", (e) => {
      e.stopPropagation();
      currentIndex = (currentIndex + 1) % galleryImages.length;
      updateCarousel();
    });

    document.addEventListener("keydown", (e) => {
      if (!lightboxModal.classList.contains("hidden")) {
        if (e.key === "Escape") closeLightbox();
        else if (e.key === "ArrowLeft") {
          currentIndex =
            (currentIndex - 1 + galleryImages.length) % galleryImages.length;
          updateCarousel();
        } else if (e.key === "ArrowRight") {
          currentIndex = (currentIndex + 1) % galleryImages.length;
          updateCarousel();
        }
      }
    });
  });
</script>
